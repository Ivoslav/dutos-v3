{% extends 'roster/base.html' %}
{% load roster_extras %}

{% block title %}–ö–∞–ª–µ–Ω–¥–∞—Ä{% endblock %}

{% block extra_css %}
<style>
    .calendar-day {
        min-height: 120px;
        border: 1px solid #dee2e6;
        background-color: #fff;
        transition: 0.2s;
        position: relative;
    }
    .calendar-day:hover {
        background-color: #f8f9fa;
        border-color: #0d6efd;
        z-index: 2;
        cursor: pointer;
    }
    .day-number { font-weight: bold; font-size: 1.2rem; color: #6c757d; }
    .today { background-color: #e7f1ff !important; border: 2px solid #0d6efd !important; }
    .has-duty { border-top: 4px solid #198754; }
    .empty-day { background-color: #f8f9fa; }
    a.fill-div { display: block; height: 100%; width: 100%; text-decoration: none; color: inherit; }
</style>
{% endblock %}

{% block content %}
<div class="mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div><a href="?month={{ prev_month }}&year={{ prev_year }}" class="btn btn-outline-primary">‚¨ÖÔ∏è –ü—Ä–µ–¥–∏—à–µ–Ω</a></div>
        <h2 class="text-uppercase text-primary mb-0">üìÖ {{ month_name }}</h2>
        <div><a href="?month={{ next_month }}&year={{ next_year }}" class="btn btn-outline-primary">–°–ª–µ–¥–≤–∞—â ‚û°Ô∏è</a></div>
    </div>

    <div class="row text-center fw-bold bg-white py-2 border rounded-top shadow-sm">
        <div class="col">–ü–æ–Ω</div><div class="col">–í—Ç–æ</div><div class="col">–°—Ä—è</div><div class="col">–ß–µ—Ç</div><div class="col">–ü–µ—Ç</div><div class="col text-danger">–°—ä–±</div><div class="col text-danger">–ù–µ–¥</div>
    </div>

    {% for week in month_days %}
    <div class="row row-cols-7 g-0">
        {% for day in week %}
            {% if day == 0 %}
                <div class="col calendar-day empty-day"></div>
{% else %}
                {% with stats=stats_by_day|get_item:day %}
                <div class="col calendar-day p-2 {% if shifts_by_day|get_item:day %}has-duty{% endif %} {% if day == today.day and month == today.month and year == today.year %}today{% endif %}">
                    <a href="{% url 'daily_roster' %}?date={{ year }}-{{ month|stringformat:'02d' }}-{{ day|stringformat:'02d' }}" class="fill-div">
                        
                        <div class="d-flex justify-content-between align-items-start">
                            <span class="day-number">{{ day }}</span>
                            {% if shifts_by_day|get_item:day %}
                                {% if stats.is_draft %}
                                    <span class="badge bg-warning text-dark shadow-sm">‚ö†Ô∏è –ß–ï–†–ù–û–í–ê</span>
                                {% else %}
                                    <span class="badge bg-success shadow-sm">‚úÖ –û–ö</span>
                                {% endif %}
                            {% else %}
                                <span class="badge bg-secondary opacity-25">-</span>
                            {% endif %}
                        </div>
                        
                        {% if stats %}
                        <div class="mt-2 d-flex justify-content-center gap-1" style="flex-wrap: wrap">
                            {% if stats.c1 > 0 %}<span class="badge bg-primary border border-light shadow-sm" title="1-–≤–∞ –†–æ—Ç–∞">1–†: {{ stats.c1 }}</span>{% endif %}
                            {% if stats.c2 > 0 %}<span class="badge bg-danger border border-light shadow-sm" title="2-—Ä–∞ –†–æ—Ç–∞">2–†: {{ stats.c2 }}</span>{% endif %}
                            {% if stats.young > 0 %}<span class="badge bg-success border border-light shadow-sm" title="–ú–ª–∞–¥–∏">–ú: {{ stats.young }}</span>{% endif %}
                        </div>
                        {% else %}
                        <div class="mt-2" style="min-height: 22px"></div>
                        {% endif %}
                        
                        {% if shifts_by_day|get_item:day %}
                            <div class="mt-2 text-center text-muted small">{{ shifts_by_day|get_item:day|length }} –Ω–∞—Ä—è–¥</div>
                        {% endif %}
                    </a>
                </div>
                {% endwith %}
            {% endif %}
        {% endfor %}
    </div>
    {% endfor %}

    <div class="mt-3 text-center text-muted small">
        <p>–õ–µ–≥–µ–Ω–¥–∞: <span class="badge bg-success">–ó–µ–ª–µ–Ω–∞ –ª–µ–Ω—Ç–∞</span> = –ò–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω –≥—Ä–∞—Ñ–∏–∫</p>
    </div>
</div>
{% endblock %}