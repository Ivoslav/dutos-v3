<!doctype html>
{% load roster_extras %}
<html lang="bg">
  <head>
    <meta charset="UTF-8" />
    <title>DUTOS - –ö–∞–ª–µ–Ω–¥–∞—Ä</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .calendar-day {
        min-height: 120px; /* –í–∏—Å–æ—á–∏–Ω–∞ –Ω–∞ –∫–ª–µ—Ç–∫–∞—Ç–∞ */
        border: 1px solid #dee2e6;
        background-color: #fff;
        transition: 0.2s;
        position: relative;
      }
      .calendar-day:hover {
        background-color: #f8f9fa;
        border-color: #0d6efd;
        z-index: 2;
        cursor: pointer;
      }
      .day-number {
        font-weight: bold;
        font-size: 1.2rem;
        color: #6c757d;
      }
      .today {
        background-color: #e7f1ff !important; /* –°–≤–µ—Ç–ª–æ —Å–∏–Ω—å–æ –∑–∞ –¥–Ω–µ—Å */
        border: 2px solid #0d6efd !important;
      }
      .has-duty {
        /* –ó–µ–ª–µ–Ω–∞ –ª–µ–Ω—Ç–∞ –∞–∫–æ –∏–º–∞ –Ω–∞—Ä—è–¥ */
        border-top: 4px solid #198754;
      }
      .empty-day {
        background-color: #f8f9fa; /* –°–∏–≤–æ –∑–∞ –¥–Ω–∏—Ç–µ –æ—Ç –¥—Ä—É–≥ –º–µ—Å–µ—Ü */
      }
      a.fill-div {
        display: block;
        height: 100%;
        width: 100%;
        text-decoration: none;
        color: inherit;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <a
            href="?month={{ prev_month }}&year={{ prev_year }}"
            class="btn btn-outline-primary"
            >‚¨ÖÔ∏è –ü—Ä–µ–¥–∏—à–µ–Ω</a
          >
        </div>
        <h2 class="text-uppercase text-primary mb-0">üìÖ {{ month_name }}</h2>
        <div>
          <a
            href="?month={{ next_month }}&year={{ next_year }}"
            class="btn btn-outline-primary"
            >–°–ª–µ–¥–≤–∞—â ‚û°Ô∏è</a
          >
        </div>
      </div>

      <div class="text-center mb-4">
        <a href="{% url 'roster_stats' %}" class="btn btn-dark shadow-sm"
          >üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a
        >
        <a href="/admin/" class="btn btn-outline-secondary shadow-sm"
          >‚öôÔ∏è –ê–¥–º–∏–Ω</a
        >
      </div>

      <div
        class="row text-center fw-bold bg-white py-2 border rounded-top shadow-sm"
      >
        <div class="col">–ü–æ–Ω</div>
        <div class="col">–í—Ç–æ</div>
        <div class="col">–°—Ä—è</div>
        <div class="col">–ß–µ—Ç</div>
        <div class="col">–ü–µ—Ç</div>
        <div class="col text-danger">–°—ä–±</div>
        <div class="col text-danger">–ù–µ–¥</div>
      </div>

      {% for week in month_days %}
      <div class="row row-cols-7 g-0">
        {% for day in week %} {% if day == 0 %}
        <div class="col calendar-day empty-day"></div>
        {% else %}
        <div
          class="col calendar-day p-2 {% if shifts_by_day|get_item:day %}has-duty{% endif %} {% if day == today.day and month == today.month and year == today.year %}today{% endif %}"
        >
          <a
            href="{% url 'roster_daily' %}?date={{ year }}-{{ month|stringformat:'02d' }}-{{ day|stringformat:'02d' }}"
            class="fill-div"
          >
            <div class="d-flex justify-content-between">
              <span class="day-number">{{ day }}</span>
              {% if shifts_by_day|get_item:day %}
              <span class="badge bg-success">OK</span>
              {% else %}
              <span class="badge bg-secondary opacity-25">-</span>
              {% endif %}
            </div>

            {% with stats=stats_by_day|get_item:day %} {% if stats %}
            <div
              class="mt-2 d-flex justify-content-center gap-1"
              style="flex-wrap: wrap"
            >
              {% if stats.c1 > 0 %}
              <span
                class="badge bg-primary border border-light shadow-sm"
                title="1-–≤–∞ –†–æ—Ç–∞ (–°—Ç–∞—Ä–∏)"
              >
                1–†: {{ stats.c1 }}
              </span>
              {% endif %} {% if stats.c2 > 0 %}
              <span
                class="badge bg-danger border border-light shadow-sm"
                title="2-—Ä–∞ –†–æ—Ç–∞ (–°—Ç–∞—Ä–∏)"
              >
                2–†: {{ stats.c2 }}
              </span>
              {% endif %} {% if stats.young > 0 %}
              <span
                class="badge bg-success border border-light shadow-sm"
                title="–ú–ª–∞–¥–∏ –∫—É—Ä—Å–∞–Ω—Ç–∏"
              >
                –ú: {{ stats.young }}
              </span>
              {% endif %}
            </div>
            {% else %}
            <div class="mt-2" style="min-height: 22px"></div>
            {% endif %} {% endwith %} {% if shifts_by_day|get_item:day %}
            <div class="mt-2 text-center text-muted small">
              {{ shifts_by_day|get_item:day|length }} –Ω–∞—Ä—è–¥
            </div>
            {% endif %}
          </a>
        </div>

        {% endif %} {% endfor %}
      </div>
      {% endfor %}

      <div class="mt-3 text-center text-muted small">
        <p>
          –õ–µ–≥–µ–Ω–¥–∞: <span class="badge bg-success">–ó–µ–ª–µ–Ω–∞ –ª–µ–Ω—Ç–∞</span> = –ò–º–∞
          –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω –≥—Ä–∞—Ñ–∏–∫ | <span class="badge bg-danger">–ß–µ—Ä–≤–µ–Ω–æ</span> =
          –î–µ–∂—É—Ä–µ–Ω –ø–æ –ë–∞—Ç–∞–ª—å–æ–Ω
        </p>
      </div>
    </div>
  </body>
</html>
